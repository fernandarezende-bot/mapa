<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>SIGMAGIS - Análise Temporal</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        body { margin: 0; padding: 0; }
        #map { width: 100%; height: 100vh; background: #ffffff; }
        .popup-container { text-align: center; font-family: sans-serif; min-width: 200px; }
        .btn-link { 
            display: block; padding: 12px; margin-top: 8px;
            background: #2c3e50; color: white !important; text-align: center;
            text-decoration: none; border-radius: 4px; font-weight: bold;
        }
    </style>
</head>
<body>
    <div id="map"></div>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        const params = new URLSearchParams(window.location.search);
        const latlong = params.get("latlong"); 
        let lat = -18.74, lon = -53.35; 

        if (latlong) {
            const partes = latlong.split(",");
            // O formato esperado é longitude, latitude
            lon = parseFloat(partes[0]);
            lat = parseFloat(partes[1]);
        }

        const map = L.map('map').setView([lat, lon], 16);

        // Satélite estável da Esri - Carrega sempre
        L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
            maxZoom: 19,
            attribution: 'Esri World Imagery'
        }).addTo(map);

        // Marcador e Popup automático com os links de histórico real
        L.marker([lat, lon]).addTo(map)
            .bindPopup(`
                <div class="popup-container">
                    <b>SIGMAGIS - HISTÓRICO</b><br>
                    <a href="https://livingatlas.arcgis.com/wayback/#loc=${lon},${lat},17" target="_blank" class="btn-link">LINHA DO TEMPO (ESRI)</a>
                    <a href="https://earth.google.com/web/search/${lat},${lon}" target="_blank" class="btn-link" style="background:#4285F4">GOOGLE EARTH</a>
                </div>
            `).openPopup();
    </script>
</body>
</html>
