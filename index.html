<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="utf-8" />
    <title>SIGMAGIS - Painel de Histórico</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        body { margin: 0; padding: 0; font-family: sans-serif; }
        #map { width: 100%; height: 100vh; }
        .btn-hist { 
            display: block; padding: 12px; margin-top: 10px;
            background: #004a99; color: white; text-align: center;
            text-decoration: none; border-radius: 6px; font-weight: bold;
        }
    </style>
</head>
<body>
    <div id="map"></div>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="fazendas.js"></script>
    <script>
        const params = new URLSearchParams(window.location.search);
        const latlong = params.get("latlong"); 

        let lat = -18.74, lon = -53.35; // Coordenada reserva

        if (latlong) {
            const partes = latlong.split(",");
            lat = parseFloat(partes[0]);
            lon = parseFloat(partes[1]);
        }

        const map = L.map('map').setView([lat, lon], 16);

        // Base de Satélite estável
        L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}').addTo(map);

        // Desenha os polígonos das fazendas
        L.geoJSON(fazendas, {
            style: { color: "yellow", weight: 3, fillOpacity: 0 }
        }).addTo(map);

        // Popup automático com os links de análise histórica
        L.popup()
            .setLatLng([lat, lon])
            .setContent(`
                <div style="min-width:200px">
                    <h3 style="margin:0 0 10px 0">Análise Temporal</h3>
                    <a href="https://livingatlas.arcgis.com/wayback/#active=26142&loc=${lon},${lat},17" target="_blank" class="btn-hist">LINHA DO TEMPO (ESRI)</a>
                    <a href="https://earth.google.com/web/search/${lat},${lon}" target="_blank" class="btn-hist" style="background:#4285F4">GOOGLE EARTH HISTÓRICO</a>
                </div>
            `).openOn(map);
    </script>
</body>
</html>